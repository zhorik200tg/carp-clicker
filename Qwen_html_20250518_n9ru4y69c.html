<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>üêü –ö–∞—Ä–∞—Å—å-–∫–ª–∏–∫–µ—Ä</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom right, #b2ebf2, #e0f7fa);
      color: #004d40;
      text-align: center;
      padding: 30px;
      margin: 0;
      overflow-x: hidden;
      transition: background 0.5s ease, color 0.5s ease;
    }

    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      color: #006064;
      transition: color 0.5s ease;
    }

    #score {
      font-size: 1.8em;
      margin: 15px 0;
      color: #00695c;
      transition: color 0.5s ease;
    }

    #koi {
      width: 400px;
      max-width: 90vw;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.2s ease;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    }

    #koi:active {
      transform: scale(0.97);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .button {
      background-color: #00acc1;
      border: none;
      color: white;
      padding: 12px 24px;
      margin: 10px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      transition: background-color 0.3s ease, transform 0.1s ease;
    }

    .button:hover {
      background-color: #00838f;
      transform: translateY(-2px);
    }

    .button:active {
      transform: translateY(0);
    }

    /* –ü–æ–¥–ª–æ–∂–∫–∞ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è */
    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }

    /* –°—Ç–∏–ª–∏ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫ */
    .fullscreen-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: white;
      z-index: 1000;
      overflow-y: auto;
      padding: 40px 20px;
      box-sizing: border-box;
      animation: fadeIn 0.3s ease forwards;
    }

    .fullscreen-modal.slideIn {
      animation: slideInLeft 0.3s ease forwards;
    }

    .fullscreen-modal.slideOut {
      animation: slideOutRight 0.3s ease forwards;
    }

    .close-btn {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      color: red;
      transition: color 0.3s ease;
    }

    .close-btn:hover {
      color: darkred;
    }

    .tab-buttons {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    .tab-button {
      background-color: #ddd;
      border: none;
      padding: 10px 20px;
      margin: 0 10px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 6px;
      transition: background-color 0.3s ease;
    }

    .tab-button.active {
      background-color: #bbb;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    @keyframes slideInLeft {
      from { transform: translateX(-100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideOutRight {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }

    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: gold;
      color: black;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      z-index: 2000;
      animation: notifyAnim 2s ease forwards;
    }

    @keyframes notifyAnim {
      0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
      10% { opacity: 1; transform: translateX(-50%) translateY(0); }
      90% { opacity: 1; }
      100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
    }

    .achievement {
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      background-color: #e0f7fa;
      font-size: 1em;
      color: #004d40;
      border: 2px solid #b2ebf2;
    }

    .achievement.unlocked {
      background-color: #a5d6a7;
      border-color: #66bb6a;
      color: #1b5e20;
      font-weight: bold;
    }

    .themes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 10px;
    }

    .theme-box {
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .theme-box:hover {
      transform: scale(1.05);
    }

    input[type="color"] {
      width: 60px;
      height: 35px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 24px;
    }

    .slider:before {
      content: "";
      position: absolute;
      height: 20px;
      width: 20px;
      left: 2px;
      bottom: 2px;
      background: white;
      transition: 0.4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #2196F3;
    }

    input:focus + .slider {
      box-shadow: 0 0 1px #2196F3;
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .version {
      margin-top: 30px;
      font-size: 0.9em;
      color: #888;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    .animate-fade-in {
      animation: fadeIn 0.3s ease forwards;
    }

    .animate-slide-in-left {
      animation: slideInLeft 0.3s ease forwards;
    }

    .animate-slide-out-right {
      animation: slideOutRight 0.3s ease forwards;
    }

    .modal-enter {
      animation: slideInLeft 0.3s ease forwards;
    }

    .modal-exit {
      animation: slideOutRight 0.3s ease forwards;
    }

    .fade-overlay {
      animation: overlayFadeIn 0.3s ease forwards;
    }

    .fade-overlay-out {
      animation: overlayFadeOut 0.3s ease forwards;
    }

    @keyframes overlayFadeIn {
      from { opacity: 0; }
      to { opacity: 0.5; }
    }

    @keyframes overlayFadeOut {
      from { opacity: 0.5; }
      to { opacity: 0; }
    }
  </style>
</head>
<body>

  <!-- Overlay –¥–ª—è –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è —Ñ–æ–Ω–∞ -->
  <div class="overlay" id="overlay"></div>

  <h1>üêü –ö–∞—Ä–∞—Å—å-–∫–ª–∏–∫–µ—Ä</h1>

  <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã -->
  <img src="images/carp.png" alt="–ö–∞—Ä–∞—Å—å" id="koi">
  <p id="score">–°—á—ë—Ç: 0</p>

  <!-- –ö–Ω–æ–ø–∫–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–∫–ª–∞–¥–æ–∫ -->
  <button class="button" onclick="openModal('shopModal')">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
  <button class="button" onclick="openModal('profileModal')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
  <button class="button" onclick="openModal('allTabsModal')">üìÅ –í—Å–µ –≤–∫–ª–∞–¥–∫–∏</button>
  <button class="button" onclick="openModal('settingsModal')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>

  <!-- –í–∫–ª–∞–¥–∫–∞ "–ú–∞–≥–∞–∑–∏–Ω" -->
  <div id="shopModal" class="fullscreen-modal">
    <span class="close-btn" onclick="closeModal('shopModal')">&times;</span>
    <h2>üõí –ú–∞–≥–∞–∑–∏–Ω —É–ª—É—á—à–µ–Ω–∏–π</h2>
    <div class="tab-buttons">
      <button class="tab-button active" onclick="switchTab(this, 'autoclickTab')">üîÅ –ê–≤—Ç–æ–∫–ª–∏–∫</button>
      <button class="tab-button" onclick="switchTab(this, 'clickpowerTab')">üëÜ –ö–ª–∏–∫ –∑–∞ —Ç–∞–ø</button>
    </div>
    <div id="autoclickTab" class="tab-content active">
      <button class="button" onclick="buyAutoClick()">–ö—É–ø–∏—Ç—å –∞–≤—Ç–æ–∫–ª–∏–∫ (—Å—Ç–æ–∏—Ç 50)</button>
    </div>
    <div id="clickpowerTab" class="tab-content">
      <button class="button" onclick="buyClickPower()">–£—Å–∏–ª–µ–Ω–∏–µ –∫–ª–∏–∫–∞ +1 (—Å—Ç–æ–∏—Ç 10)</button>
    </div>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞ "–ü—Ä–æ—Ñ–∏–ª—å" -->
  <div id="profileModal" class="fullscreen-modal">
    <span class="close-btn" onclick="closeModal('profileModal')">&times;</span>
    <h2>üìä –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
    <div class="stats">
      <p>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤: <span id="stat-score">0</span></p>
      <p>–°–∏–ª–∞ –∫–ª–∏–∫–∞: <span id="stat-power">1</span></p>
      <p>–ê–≤—Ç–æ–∫–ª–∏–∫ –∞–∫—Ç–∏–≤–µ–Ω: <span id="stat-autoclick">–ù–µ—Ç</span></p>
    </div>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞ "–í—Å–µ –≤–∫–ª–∞–¥–∫–∏" -->
  <div id="allTabsModal" class="fullscreen-modal">
    <span class="close-btn" onclick="closeModal('allTabsModal')">&times;</span>
    <h2>üìÅ –í—Å–µ –≤–∫–ª–∞–¥–∫–∏</h2>
    <div class="tab-buttons">
      <button class="tab-button active" onclick="switchAllTabsTab(this, 'customizationTab')">üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è</button>
      <button class="tab-button" onclick="switchAllTabsTab(this, 'achievementsTab')">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
    </div>
    <div id="customizationTab" class="tab-content active">
      <div class="tab-buttons">
        <button class="tab-button active" onclick="switchCustomizeTab(this, 'paletteTab')">üé® –ü–∞–ª–∏—Ç—Ä–∞</button>
        <button class="tab-button" onclick="switchCustomizeTab(this, 'themesTab')">üñº –¢–µ–º—ã</button>
      </div>
      <div id="paletteTab" class="tab-content active">
        <form class="color-picker">
          <label for="bgColor">–¶–≤–µ—Ç —Ñ–æ–Ω–∞:</label>
          <input type="color" id="bgColor" value="#b2ebf2" onchange="changeBackground(this.value)">
          <br><br>
          <label for="textColor">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞:</label>
          <input type="color" id="textColor" value="#004d40" onchange="changeText(this.value)">
          <br><br>
          <label for="btnColor">–¶–≤–µ—Ç –∫–Ω–æ–ø–æ–∫:</label>
          <input type="color" id="btnColor" value="#00acc1" onchange="changeButtons(this.value)">
        </form>
      </div>
      <div id="themesTab" class="tab-content">
        <div class="search-box">
          <input type="text" id="themeSearch" placeholder="–ü–æ–∏—Å–∫ —Ç–µ–º—ã..." onkeyup="filterThemes()">
        </div>
        <div class="themes-grid" id="themesGrid"></div>
      </div>
    </div>

    <div id="achievementsTab" class="tab-content">
      <h3>üèÜ –í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
      <div id="achievementsList"></div>
    </div>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" -->
  <div id="settingsModal" class="fullscreen-modal">
    <span class="close-btn" onclick="closeModal('settingsModal')">&times;</span>
    <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
    <div class="settings-group">
      <button class="button" onclick="saveProgress()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
      <button class="button" onclick="loadProgress()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
      <button classbutton.onclick="resetGame()">üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É</button>
      <button class="button" onclick="copyProgress()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
    </div>

    <div class="settings-group">
      <label>üîä –ó–≤—É–∫–∏</label>
      <label class="switch">
        <input type="checkbox" id="soundToggle" checked>
        <span class="slider"></span>
      </label>
    </div>

    <div class="settings-group">
      <label>‚ÑπÔ∏è –í–µ—Ä—Å–∏—è –∏–≥—Ä—ã</label>
      <p class="version">v1.0.0</p>
    </div>
  </div>

  <script>
    let score = 0;
    let clickPower = 1;
    let autoClickInterval = null;

    const scoreDisplay = document.getElementById("score");
    const koi = document.getElementById("koi");

    const statScore = document.getElementById("stat-score");
    const statPower = document.getElementById("stat-power");
    const statAutoClick = document.getElementById("stat-autoclick");

    // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    const achievements = [
      {id: 'first_click', name: '–ü–µ—Ä–≤—ã–π –∫–ª–∏–∫', condition: s => s.totalClicks >= 1},
      {id: 'ten_clicks', name: '–•–æ—Ä–æ—à–∏–π —Å—Ç–∞—Ä—Ç!', condition: s => s.totalClicks >= 10},
      {id: 'hundred_clicks', name: '–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–ª–∏–∫–µ—Ä', condition: s => s.totalClicks >= 100},
      {id: 'thousand_clicks', name: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª', condition: s => s.totalClicks >= 1000},
      {id: 'click_power_1', name: '–°–∏–ª–∞ –≤ —Ä—É–∫–∞—Ö!', condition: s => s.clickPower >= 2},
      {id: 'click_power_5', name: '–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π —É–¥–∞—Ä!', condition: s => s.clickPower >= 5},
      {id: 'score_10', name: '–°—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å', condition: s => s.score >= 10},
      {id: 'score_50', name: '–†–∞–∑–º–∏–Ω–∫–∞', condition: s => s.score >= 50},
      {id: 'score_100', name: '–¢—ã —É–∂–µ –∫—Ç–æ-—Ç–æ!', condition: s => s.score >= 100},
      {id: 'score_500', name: '–í–µ–ª–∏–∫–∏–π —Ä—ã–±–∞–∫', condition: s => s.score >= 500},
      {id: 'score_1000', name: '–ì—Ä–∞–Ω–¥–º–∞—Å—Ç–µ—Ä', condition: s => s.score >= 1000},
      {id: 'auto_clicker_bought', name: '–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è', condition: s => s.autoClickBought},
      {id: 'score_50_auto', name: '–ë–æ–≥–∞—á –Ω–∞ 50', condition: s => s.score >= 50 && s.autoClickBought},
      {id: 'score_100_auto', name: '–û–ø—ã—Ç–Ω—ã–π –±–æ–≥–∞—á', condition: s => s.score >= 100 && s.autoClickBought},
      {id: 'click_power_10', name: '–£–¥–∞—Ä –º–æ–ª–Ω–∏–∏', condition: s => s.clickPower >= 10},
      {id: 'score_10000', name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–∞—Ä–∞—Å—å', condition: s => s.score >= 10000},
      {id: 'score_5000', name: '–ú–∏–ª–ª–∏–æ–Ω–µ—Ä –≤ —Å–≤–æ—ë–º –¥–µ–ª–µ', condition: s => s.score >= 5000},
      {id: 'all_tabs_opened', name: '–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å', condition: s => s.tabsOpened === 4},
      {id: 'dark_theme_used', name: '–¢–µ–º–Ω–æ—Ç–∞ –≤–æ –±–ª–∞–≥–æ', condition: s => s.currentTheme === 'dark'},
      {id: 'max_combo', name: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∫–ª–∏–∫', condition: s => s.clickPower >= 10 && s.autoClickBought}
    ];

    let unlockedAchievements = new Set();
    let totalClicks = 0;
    let openedTabs = new Set();
    let currentTheme = 'light';

    function updateScore() {
      score += clickPower;
      scoreDisplay.textContent = "–°—á—ë—Ç: " + Math.floor(score);
      totalClicks++;
      checkAchievements();
      updateStats();
    }

    koi.addEventListener("click", () => {
      updateScore();
    });

    function buyClickPower() {
      const cost = 10;
      if (score >= cost) {
        score -= cost;
        clickPower += 1;
        updateScore();
        alert("–í—ã —É—Å–∏–ª–∏–ª–∏ –∫–ª–∏–∫! –¢–µ–ø–µ—Ä—å –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ +" + clickPower + " –∑–∞ –∫–ª–∏–∫.");
        checkAchievements();
      } else {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏!");
      }
    }

    function buyAutoClick() {
      const cost = 50;
      if (score >= cost && !autoClickInterval) {
        score -= cost;
        updateScore();
        autoClickInterval = setInterval(() => {
          score += clickPower;
          scoreDisplay.textContent = "–°—á—ë—Ç: " + Math.floor(score);
          updateStats();
          checkAchievements();
        }, 1000);
        alert("–ê–≤—Ç–æ–∫–ª–∏–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!");
        checkAchievements();
      } else if (autoClickInterval) {
        alert("–ê–≤—Ç–æ–∫–ª–∏–∫ —É–∂–µ –∫—É–ø–ª–µ–Ω!");
      } else {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∞–≤—Ç–æ–∫–ª–∏–∫–∞!");
      }
    }

    function updateStats() {
      statScore.textContent = Math.floor(score);
      statPower.textContent = clickPower;
      statAutoClick.textContent = autoClickInterval ? "–î–∞" : "–ù–µ—Ç";
    }

    function openModal(id) {
      const modal = document.getElementById(id);
      const overlay = document.getElementById("overlay");

      document.querySelectorAll('.fullscreen-modal').forEach(m => m.classList.remove('slideIn', 'slideOut'));
      void modal.offsetWidth;
      modal.style.display = 'block';
      modal.classList.add('slideIn');
      overlay.classList.add('fade-overlay');
      overlay.style.display = 'block';
    }

    function closeModal(id) {
      const modal = document.getElementById(id);
      const overlay = document.getElementById("overlay");

      modal.classList.remove('slideIn');
      modal.classList.add('slideOut');

      setTimeout(() => {
        modal.style.display = 'none';
        modal.classList.remove('slideOut');
        overlay.classList.remove('fade-overlay');
        overlay.style.display = 'none';
      }, 300);
    }

    function switchTab(button, tabId) {
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');

      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
    }

    function switchAllTabsTab(button, tabId) {
      document.querySelectorAll('#allTabsModal .tab-button').forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');

      document.querySelectorAll('#allTabsModal .tab-content').forEach(tab => tab.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
    }

    function switchCustomizeTab(button, tabId) {
      document.querySelectorAll('#customizationTab .tab-button').forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');

      document.querySelectorAll('#customizationTab .tab-content').forEach(tab => tab.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
    }

    function generateThemes() {
      const themesGrid = document.getElementById("themesGrid");
      window.themes = [
        { name: '–ó–µ–ª—ë–Ω–∞—è', bg: '#a5d6a7', text: '#2e7d32', btn: '#66bb6a' },
        { name: '–ú–æ—Ä—Å–∫–∞—è', bg: '#90caf9', text: '#0d47a1', btn: '#42a5f5' },
        { name: '–¢—ë–º–Ω–∞—è', bg: '#212121', text: '#eeeeee', btn: '#424242' },
        { name: '–ö—Ä–∞—Å–Ω–∞—è', bg: '#ef9a9a', text: '#c62828', btn: '#e53935' },
        { name: '–ñ—ë–ª—Ç–∞—è', bg: '#fff59d', text: '#fbc02d', btn: '#fdd835' },
        { name: '–§–∏–æ–ª–µ—Ç–æ–≤–∞—è', bg: '#ce93d8', text: '#6a1b9a', btn: '#ab47bc' },
        { name: '–û—Ä–∞–Ω–∂–µ–≤–∞—è', bg: '#ffe082', text: '#ffa726', btn: '#ffb300' },
        { name: '–°–µ—Ä–∞—è', bg: '#e0e0e0', text: '#424242', btn: '#9e9e9e' },
        { name: '–ì–æ–ª—É–±–∞—è', bg: '#81d4fa', text: '#0277bd', btn: '#29b6f6' },
        { name: '–ö–æ—Ñ–µ', bg: '#d7ccc8', text: '#3e2723', btn: '#a1887f' }
      ];

      themesGrid.innerHTML = '';
      window.themes.forEach(theme => {
        const div = document.createElement("div");
        div.className = "theme-box";
        div.textContent = theme.name;
        div.style.background = theme.bg;
        div.style.color = theme.text;
        div.onclick = () => applyTheme(theme);
        themesGrid.appendChild(div);
      });
    }

    function filterThemes() {
      const query = document.getElementById("themeSearch").value.toLowerCase();
      const boxes = document.getElementById("themesGrid").getElementsByClassName("theme-box");
      Array.from(boxes).forEach(box => {
        const txtValue = box.textContent || box.innerText;
        box.style.display = txtValue.toLowerCase().indexOf(query) > -1 ? "block" : "none";
      });
    }

    function applyTheme(theme) {
      changeBackground(theme.bg);
      changeText(theme.text);
      changeButtons(theme.btn);
      currentTheme = theme.name;
      checkAchievements();
    }

    function changeBackground(color) {
      document.body.style.background = `linear-gradient(to bottom right, ${color}, ${shadeColor(color, -20)})`;
    }

    function changeText(color) {
      document.body.style.color = color;
      document.querySelector('h1').style.color = color;
      document.querySelector('#score').style.color = shadeColor(color, -30);
    }

    function changeButtons(color) {
      document.querySelectorAll('.button').forEach(btn => btn.style.backgroundColor = color);
    }

    function showNotification(text) {
      const notif = document.createElement("div");
      notif.className = "notification";
      notif.textContent = text;
      document.body.appendChild(notif);
      setTimeout(() => notif.remove(), 2000);
    }

    function checkAchievements() {
      const state = {
        score,
        clickPower,
        totalClicks,
        autoClickBought: !!autoClickInterval,
        tabsOpened: openedTabs.size,
        currentTheme
      };

      achievements.forEach(ach => {
        if (!unlockedAchievements.has(ach.id) && ach.condition(state)) {
          unlockedAchievements.add(ach.id);
          showNotification(`üèÜ –ü–æ–ª—É—á–µ–Ω–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: ${ach.name}`);
        }

        const el = document.getElementById('ach-' + ach.id);
        if (el) el.classList.toggle("unlocked", unlockedAchievements.has(ach.id));
      });
    }

    function generateAchievements() {
      const container = document.getElementById("achievementsList");
      container.innerHTML = "";
      achievements.forEach(ach => {
        const div = document.createElement("div");
        div.className = "achievement";
        div.id = 'ach-' + ach.id;
        div.textContent = ach.name;
        container.appendChild(div);
      });
      checkAchievements();
    }

    function saveProgress() {
      const data = {
        score,
        clickPower,
        autoClickBought: !!autoClickInterval,
        totalClicks,
        currentTheme
      };
      localStorage.setItem("carpClickerSave", JSON.stringify(data));
      showNotification("üíæ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω!");
    }

    function loadProgress() {
      const data = JSON.parse(localStorage.getItem("carpClickerSave"));
      if (data) {
        score = data.score;
        clickPower = data.clickPower;
        totalClicks = data.totalClicks;
        currentTheme = data.currentTheme;

        if (data.autoClickBought && !autoClickInterval) {
          autoClickInterval = setInterval(() => {
            score += clickPower;
            scoreDisplay.textContent = "–°—á—ë—Ç: " + Math.floor(score);
            updateStats();
          }, 1000);
        }

        updateScore();
        applyTheme(window.themes.find(t => t.name === currentTheme) || window.themes[0]);
        showNotification("üîÑ –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∂–µ–Ω!");
      } else {
        alert("–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞!");
      }
    }

    function resetGame() {
      if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É?")) {
        score = 0;
        clickPower = 1;
        totalClicks = 0;
        currentTheme = 'light';
        if (autoClickInterval) clearInterval(autoClickInterval);
        autoClickInterval = null;
        updateScore();
        applyTheme(window.themes[0]);
        unlockedAchievements.clear();
        generateAchievements();
        showNotification("üóëÔ∏è –ò–≥—Ä–∞ —Å–±—Ä–æ—à–µ–Ω–∞!");
      }
    }

    function copyProgress() {
      const data = JSON.stringify({
        score,
        clickPower,
        totalClicks,
        autoClickBought: !!autoClickInterval,
        currentTheme
      });

      navigator.clipboard.writeText(data).then(() => {
        showNotification("üìã –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä!");
      }).catch(() => {
        alert("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è");
      });
    }

    function updateStats() {
      statScore.textContent = Math.floor(score);
      statPower.textContent = clickPower;
      statAutoClick.textContent = autoClickInterval ? "–î–∞" : "–ù–µ—Ç";
    }

    function generateAllContent() {
      generateThemes();
      generateAchievements();
    }

    function shadeColor(color, percent) {
      let R = parseInt(color.substring(1,3),16);
      let G = parseInt(color.substring(3,5),16);
      let B = parseInt(color.substring(5,7),16);

      R = Math.min(255, Math.max(0, parseInt(R * (100 + percent)/100)));
      G = Math.min(255, Math.max(0, parseInt(G * (100 + percent)/100)));
      B = Math.min(255, Math.max(0, parseInt(B * (100 + percent)/100)));

      return "#" +
        ((R < 16 ? "0" : "") + R.toString(16)) +
        ((G < 16 ? "0" : "") + G.toString(16)) +
        ((B < 16 ? "0" : "") + B.toString(16));
    }

    window.onload = () => {
      generateAllContent();
      const saved = JSON.parse(localStorage.getItem("carpClickerSave") || "{}");
      if (saved.score !== undefined) loadProgress();

      const settings = JSON.parse(localStorage.getItem("carpClickerSettings") || "{}");
      document.getElementById("soundToggle").checked = settings.sound !== false;
    };

    window.onbeforeunload = () => {
      localStorage.setItem("carpClickerSettings", JSON.stringify({
        sound: document.getElementById("soundToggle").checked
      }));
    };
  </script>

</body>
</html>